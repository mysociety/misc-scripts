#!/bin/sh
# Shorter interface to deploy scripts on servers.
set -e

die () {
    echo "mysociety:" "$@" 1>&2
    exit 1
}

show_help () {
	cat <<END
Usage: mysociety COMMAND

COMMAND is any of:
  config - deploy new config for current server
  vhost VHOST - deploy latest version of VHOST, e.g. www.pledgebank.com

Extra parameters are passed through to underlying script.
END
	exit
}

COMMAND=$1
shift
if [ "$COMMAND" = "config" ]
then
	HOST=`hostname`
        if [ x$HOST = x ] ; then
            die "can't establish hostname"
        fi

        case $HOST in
            tea|bitter)
                ARCHETYPE=bitter
                ;;
            *)
                die "don't know how to configure this host ($HOST)"
                ;;
        esac

	/data/mysociety/bin/deploy-configuration /data/servers/$ARCHETYPE /data/servers/$HOST.pl "$@"
elif [ "$COMMAND" = "vhost" ]
then
    VHOST=$1
    shift
	[ "$VHOST" = "" ] && show_help
	/data/mysociety/bin/deploy-vhost $VHOST "$@"
else
	show_help
fi

