#!/bin/bash
#
# update-index:
# Create Debian repository index files.
#
# $Id: debian-vhost-update,v 1.9 2012-10-29 18:14:35 matthew Exp $
#

if [ "`hostname`" != 'leopard' ]
then
    echo "Run on leopard only"
    exit
fi

cd /data/vhost/debian.mysociety.org/docs

for i in `find dists -name "binary-*"`
do
	echo "Generating Packages.gz file for: $i"
	dpkg-scanpackages $i /dev/null | gzip -9c > $i/Packages.gz.new && mv $i/Packages.gz.new $i/Packages.gz || rm $i/Packages.gz.new
done

for i in `find dists -name source`
do
	echo "Generating Sources.gz file for: $i"
	dpkg-scansources $i /dev/null | gzip -9c > $i/Sources.gz.new && mv $i/Sources.gz.new $i/Sources.gz || rm $i/Sources.gz.new
done


