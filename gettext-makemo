#!/bin/bash
#
# bin/gettext-makemo
# Convert all .po files of translations into .mo files
#
# --verbose - show status of all translations
#
# Copyright (c) 2005 UK Citizens Online Democracy. All rights reserved.
# Email: francis@mysociety.org; WWW: http://www.mysociety.org/
#
# $Id: gettext-makemo,v 1.8 2006-02-25 17:05:32 matthew Exp $

if [ ! -d locale ]
then
    echo "Run in root mysociety directory with locale directory just below"!
    exit
fi

MSGFMT_PARAMS="-v"
if [ "$1" = "--quiet" ]
then
    MSGFMT_PARAMS=""
fi

# count number of times Subject: appears in original, times two
SUBJECT_COUNT_ORIG=`grep '^"Subject:' locale/PledgeBank.po locale/PledgeBank.po | egrep -v "^#" | wc --lines`

for X in locale/*.UTF-8
do
    if [ -d $X ]
    then
        cd $X/LC_MESSAGES

        [ "$1" != "--quiet" ] && echo -n "$X: " 
        msgfmt -c $MSGFMT_PARAMS -o PledgeBank.mo PledgeBank.po
        SUBJECT_COUNT=`grep '^"Subject:' PledgeBank.po  | egrep -v "^#" | wc --lines`
        if [ "$SUBJECT_COUNT" != "$SUBJECT_COUNT_ORIG" ] 
        then
            echo "WARNING: Email 'Subject:' lines have probably been translated in $X' (got $SUBJECT_COUNT, $SUBJECT_COUNT_ORIG expected)"
        fi

        cd ../../../
    fi
done

